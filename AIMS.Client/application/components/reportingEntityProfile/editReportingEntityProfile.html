<form (submit)="save()" [hidden]="complete">
    <h4>{{ title }}</h4>
    <div class="row">
        <tabset>
            <tab heading="General">
                <form-input [entity]="entity" name="Name" title="Name">
                    <input type="text" class="form-control" name="Name" [(ngModel)]="entity.Name">
                </form-input>

            </tab>
            <tab heading="Ledger Accounts">
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Closing Account</th>
                        <th></th>
                        <th>
                            <button type="button" class="btn" (click)="addLedgerAccount()">Add</button>
                        </th>
                    </tr>
                    <tr *ngFor="#ledgerAccount of entity.LedgerAccounts">
                        <td>
                            <input type="text" class="form-control" name="Name" [(ngModel)]="ledgerAccount.Name">
                        </td>
                        <td>
                            <entity-dropdown 
                                             [(value)]="ledgerAccount.LedgerAccountTypeID"
                                             name="LedgerAccountTypeID"
                                             query="LedgerAccountTypes"
                                             keyField="ID"
                                             displayField="Name"
                                             nullable="false">
                            </entity-dropdown>
                        </td>
                        <td>
                            <!-- closing account -->
                        </td>
                        <td></td>
                        <td>
                            <button type="button" class="btn" (click)="removeLedgerAccount(ledgerAccount)"><i class="fa fa-trash fa-fw"></i></button>
                        </td>

                    </tr>
                </table>
            </tab>


            <tab heading="Coverage Profiles">
                <table>
                    <tr>
                        <th>Coverage</th>
                        <th>Income Account</th>
                        <th>Expense Account</th>
                        <th></th>
                        <th>
                            <button type="button" class="btn" (click)="addCoverageProfile()">Add</button>
                        </th>
                    </tr>
                    <tr *ngFor="#coverageProfile of entity.CoverageProfiles">
                        <td>
                            <entity-dropdown 
                                             [(value)]="coverageProfile.CoverageTypeID"
                                             name="CoverageTypeID"
                                             query="CoverageTypes"
                                             keyField="ID"
                                             displayField="Name"
                                             nullable="false">
                            </entity-dropdown>
                        </td>
                        <td>
                            <entity-dropdown 
                                             [(value)]="coverageProfile.IncomeLedgerAccountID"
                                             name="IncomeLedgerAccountID"
                                             [boundList]="entity.LedgerAccounts"
                                             keyField="ID"
                                             displayField="Name"
                                             nullable="false">
                            </entity-dropdown>
                        </td>
                        <td>
                            <entity-dropdown 
                                             [(value)]="coverageProfile.ExpenseLedgerAccountID"
                                             name="ExpenseLedgerAccountID"
                                             [boundList]="entity.LedgerAccounts"
                                             keyField="ID"
                                             displayField="Name"
                                             nullable="false">
                            </entity-dropdown>
                        </td>
                        <td></td>
                        <td>
                            <button type="button" class="btn" (click)="removeCoverageProfile(coverageProfile)"><i class="fa fa-trash fa-fw"></i></button>
                        </td>

                    </tr>
                </table>
            </tab>


            <tab heading="Journal Templates">

                <button type="button" class="btn" (click)="addJournalTemplate()">Add</button>

                <tabset>
                    <tab *ngFor="#journalTemplate of entity.JournalTemplates" heading="{{ journalTemplate.Description }}">

                        <tabset>
                            <tab heading="General">
                                <form-input [entity]="journalTemplate" name="Description" title="Name">
                                    <input type="text" class="form-control" name="Description" [(ngModel)]="journalTemplate.Description">
                                </form-input>

                                <form-input [entity]="journalTemplate" name="JournalTypeID" title="Type">
                                    <entity-dropdown 
                                                     [(value)]="journalTemplate.JournalTypeID"
                                                     name="JournalTypeID"
                                                     query="JournalTypes"
                                                     keyField="ID"
                                                     displayField="Name"
                                                     nullable="false">
                                    </entity-dropdown>
                                </form-input>

                                <form-input [entity]="journalTemplate" name="TransactionOrigin" title="Origin">
                                    <select class="form-control" [(ngModel)]="journalTemplate.TransactionOrigin">
                                        <option value="G">Global</option>
                                        <option value="P">Policy</option>
                                        <option value="U">Public</option>
                                        <option value="A">Agent</option>
                                        <option value="B">Branch</option>
                                    </select>
                                </form-input>
                            </tab>
                            <tab heading="Inputs">

                                <table>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th></th>
                                        <th>
                                            <button type="button" class="btn" (click)="addJournalTemplateInput(journalTemplate)">Add</button>
                                        </th>
                                    </tr>
                                    <tr *ngFor="#input of journalTemplate.Inputs">
                                        <td>
                                            <input type="text" class="form-control" name="Name" [(ngModel)]="input.Name">
                                        </td>
                                        <td>
                                            <entity-dropdown 
                                                             [(value)]="input.AttributeDataTypeID"
                                                             name="AttributeDataTypeID"
                                                             query="AttributeDataTypes"
                                                             keyField="ID"
                                                             displayField="Description"
                                                             nullable="false">
                                            </entity-dropdown>
                                        </td>
                                    </tr>
                                </table>

                            </tab>
                            <tab heading="Journal Transactions">


                                <div class="card card-block card-header" *ngFor="#txn of journalTemplate.JournalTemplateTxns">
                                    <div class="well well-lg">
                                        <form-input [entity]="txn" name="Description" title="Description">
                                            <input type="text" class="form-control" name="Description" [(ngModel)]="txn.Description">
                                        </form-input>

                                        <form-input [entity]="txn" name="PublicRequirementID" title="Public Requirement">
                                            <entity-dropdown 
                                                             [(value)]="txn.PublicRequirementID"
                                                             name="PublicRequirementID"
                                                             query="PublicRequirements"
                                                             keyField="ID"
                                                             displayField="Name"
                                                             nullable="true">
                                            </entity-dropdown>
                                        </form-input>

                                        <form-input [entity]="txn" name="ServiceProviderTypeID" title="Service Provider Type">
                                            <entity-dropdown 
                                                             [(value)]="txn.ServiceProviderTypeID"
                                                             name="ServiceProviderTypeID"
                                                             query="ServiceProviderTypes"
                                                             keyField="ID"
                                                             displayField="Name"
                                                             nullable="true">
                                            </entity-dropdown>
                                        </form-input>

                                        <form-input [entity]="txn" name="AgentTypeID" title="Agent Type">
                                            <entity-dropdown 
                                                             [(value)]="txn.AgentTypeID"
                                                             name="AgentTypeID"
                                                             query="AgentTypes"
                                                             keyField="ID"
                                                             displayField="Name"
                                                             nullable="true">
                                            </entity-dropdown>
                                        </form-input>
                                    </div>
                                    <table>
                                        <caption>Postings</caption>
                                        <tr>
                                            <th>Ledger Account</th>
                                            <th>Post Type</th>
                                            <th>Add Base Amount</th>
                                            <th>Inherit Policy</th>
                                            <th>Inherit Public</th>
                                            <th></th>
                                            <th>
                                                <button type="button" class="btn" (click)="addJournalTemplateTxnPosting(txn)">Add</button>
                                            </th>
                                        </tr>
                                        <tr *ngFor="#posting of txn.Postings">
                                            <td>
                                                <entity-dropdown 
                                                                 [(value)]="posting.LedgerAccountID"
                                                                 name="LedgerAccountID"
                                                                 [boundList]="entity.LedgerAccounts"
                                                                 keyField="ID"
                                                                 displayField="Name"
                                                                 nullable="false">
                                                </entity-dropdown>
                                            </td>
                                            <td>
                                                <select class="form-control" [(ngModel)]="posting.PostType">
                                                    <option value="D">Debit</option>
                                                    <option value="C">Credit</option>
                                                </select>
                                            </td>
                                            <td>
                                                <input type="checkbox" class="form-control" name="AddBaseAmount" [(ngModel)]="posting.AddBaseAmount">
                                            </td>
                                            <td>
                                                <input type="checkbox" class="form-control" name="InheritPolicy" [(ngModel)]="posting.InheritPolicy">
                                            </td>
                                            <td>
                                                <input type="checkbox" class="form-control" name="InheritPublic" [(ngModel)]="posting.InheritPublic">
                                            </td>

                                        </tr>
                                    </table>
                                </div>

                                <button type="button" class="btn" (click)="addJournalTemplateTxn(journalTemplate)">Add</button>

                                
                            </tab>
                        </tabset>

                    </tab>
                </tabset>

            </tab>
        </tabset>

    </div>

    <error-summary [canShow]="showErrorSummary" [entity]="entity"></error-summary>

    <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
    </div>


</form>
